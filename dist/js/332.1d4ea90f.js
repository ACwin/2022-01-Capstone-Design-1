"use strict";(self["webpackChunkfront"]=self["webpackChunkfront"]||[]).push([[332],{9332:function(e,t,a){a.r(t),a.d(t,{default:function(){return V}});var l=a(3396),r=a(7139),n=a(4870),o=a(9733),u=a(6431),d=a(678),s=a(5410),c=a.n(s);const i={class:"main"},p={class:"caritems"},m=["src"],f={class:"goodsnewseinfo"},v={class:"goodsname"},g={class:"price"},b={class:"goodsprice"},h={class:"tool"},k=["value"],_=(0,l.Uk)("Delete"),y=(0,l.Uk)("All");var I={__name:"CartView",setup(e){const{proxy:t}=(0,l.FN)(),a=(0,d.tv)(),s=(0,n.iH)([]),I=(0,n.iH)(!0),w=()=>history.back(),C=()=>{t.request.get("/api/cart/list").then((e=>{1e4===e.data.status?s.value=e.data.data:10007===e.data.status?(o.F.fail("Please login first"),a.replace("/login")):o.F.fail(e.data.msg)}))},V=e=>{o.F.loading({forbidClick:!0}),t.request.post("/api/cart/update",c().stringify({productId:parseInt(event.currentTarget.parentElement.parentElement.querySelector(".dataProductId").value),count:e})).then((e=>{o.F.clear(),1e4===e.data.status?C():o.F.fail(e.data.msg)}))},F=()=>{const e=parseInt(event.currentTarget.parentElement.parentElement.querySelector(".dataProductId").value);u.V.confirm({title:"Are you sure to delete this data?",confirmButtonText:"Confirm",cancelButtonText:"Cancel"}).then((()=>{o.F.loading({forbidClick:!0}),t.request.post("/api/cart/delete",c().stringify({productId:e})).then((e=>{o.F.clear(),1e4===e.data.status?C():o.F.fail(e.data.msg)}))})).catch((()=>{}))},U=e=>{if(null!==event.currentTarget.parentElement.parentElement.querySelector(".dataProductId")){const t=parseInt(event.currentTarget.parentElement.parentElement.querySelector(".dataProductId").value);for(let a of s.value)a.id===t&&(a.selected=e)}else for(let t of s.value)t.selected=e},q=e=>{for(let t of s.value)t.selected=e},P=()=>{let e=[];for(let t of s.value)t.selected&&e.push(t.id);o.F.success("Checkout success"),console.log("模拟提交到下订单接口，提交的购物车数据ID数组：",JSON.stringify(e),"后台可以获取这数组，并根据ID查询购物车数据，并下单。注意这里不能传递数量、价格等，数量价格只能在后端查询！！！")},S=(0,l.Fl)((()=>{let e=0;for(let t of s.value)t.selected&&(e+=t.totalPrice);return 100*e}));return C(),(e,t)=>{const a=(0,l.up)("van-nav-bar"),o=(0,l.up)("van-checkbox"),u=(0,l.up)("van-stepper"),d=(0,l.up)("van-button"),c=(0,l.up)("van-submit-bar");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(a,{title:"Car","left-arrow":"",onClickLeft:w}),(0,l._)("div",i,[(0,l._)("div",p,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(s.value,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{key:t,class:"caritem"},[(0,l.Wm)(o,{modelValue:e.selected,"onUpdate:modelValue":t=>e.selected=t,modelModifiers:{value:!0},class:"chk",onChange:U},null,8,["modelValue","onUpdate:modelValue"]),(0,l._)("img",{src:e.productImage},null,8,m),(0,l._)("div",f,[(0,l._)("div",v,(0,r.zw)(e.productName),1),(0,l._)("div",g,[(0,l.Uk)(" price: ¥"+(0,r.zw)(e.price)+"   totalPrice: ",1),(0,l._)("span",b," ¥"+(0,r.zw)(e.totalPrice),1)]),(0,l._)("div",h,[(0,l._)("input",{type:"hidden",value:e.productId,class:"dataProductId"},null,8,k),(0,l.Wm)(u,{modelValue:e.quantity,"onUpdate:modelValue":t=>e.quantity=t,modelModifiers:{value:!0},theme:"round","button-size":"22","disable-input":"","before-change":V},null,8,["modelValue","onUpdate:modelValue"]),(0,l.Wm)(d,{type:"danger",size:"small",onClick:F},{default:(0,l.w5)((()=>[_])),_:1})])])])))),128))])]),(0,l.Wm)(c,{price:(0,n.SU)(S),"button-text":"Submit order",label:"Total",onSubmit:P,disabled:0===(0,n.SU)(S)},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e),onChange:q},{default:(0,l.w5)((()=>[y])),_:1},8,["modelValue"])])),_:1},8,["price","disabled"])],64)}}},w=a(89);const C=(0,w.Z)(I,[["__scopeId","data-v-f13f9684"]]);var V=C}}]);